<div class ="container">
    <div class="title">
        <h1><%= @itinerary.name %></h1>
         <% if @itinerary.user.avatar.attached? %>
            <%= cl_image_tag @itinerary.user.avatar.key, class: "avatar"%>
          <%else%>
            <div class="avatar-icon"><i class="fas fa-user-circle"></i></div>
          <%end%> 
          <p>Written by <%= @itinerary.user.first_name %>, joined in <%= @itinerary.user.created_at.year%></p>
        <p><%= @itinerary.summary %></p>
    </div>

    <div id="map"
        style="width: 100%; height: 400px;"
        data-markers="<%= @markers.to_json %>"
        data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
   
    <div class="bootstrap-tabs">
        <ul class="nav nav-tabs" id="myTab" role="tablist">    
            <% @itinerary.destinations.each do |d| %>
                <li class="nav-item">
                    <a class="nav-link <%= 'active' if @itinerary.destinations.first == d %>" id="<%= d.city.downcase.gsub(/\s+/, "") %>-tab" <%= 'aria-selected="true"' if @destinations.first == d %> href="#<%= d.city.downcase.gsub(/\s+/, "") %>" data-toggle="tab" role="tab" aria-controls="<%= d.city.downcase.gsub(/\s+/, "") %>"><%= d.city %>
                    </a>
                </li>
            <% end %>
        </ul>

        <div class="tab-content" id="myTabContent">
            <% @itinerary.destinations.each_with_index do |d, i| %>
                <div class="tab-pane fade <%= 'show active' if i == 0 %>" id="<%= d.city.downcase.gsub(/\s+/, "") %>" role="tabpanel" aria-labelledby="<%= d.city.downcase.gsub(/\s+/, "") %>-tab">
                    <div class="info">
                        <%= d.date%>
                        <%= d.city%>
                        <%= d.country%> 
                    </div>
                    <p><%= d.description%></p><br>
                    <div class="d-image-box row">
                        <% d.photos.each do |photo|%>
                            <div class="destination-image col-12 col-lg-6" >
                                <%= cl_image_tag photo.key %>
                            </div>
                        <%end%>
                    </div>    
                    <% if d.activities.any?%>
                        <h2 class="category">Things to do in <%=d.city%></h2>
                        <% d.activities.each do |a| %>
                            <div class="activity-box">
                                <h3><%= a.name%></h3><br>
                                    <% a.photos.each do |photo|%>
                                        <div class="activity-image"> 
                                            <%= cl_image_tag photo.key %>
                                        </div>
                                    <%end%>
                                <%= a.description%>
                            </div>
                        <%end%>
                    <%end%>  
                    <% if d.transports.any? %>  
                    <h2 class="category">Transport</h2>
                        <% d.transports.each do |t| %>
                            <div class="activity-box">
                                <h3><%= t.start_location %> to <%= t.end_location%></h3><br>
                                <%= t.description%>
                            </div>
                        <%end%>
                    <%end%>
                    <% if @itinerary.user == current_user %>    
                        <div class="button-list">
                            <p>Add more information:</P>
                            <%= link_to "Transport", new_itinerary_destination_transport_path(@itinerary, d) %>
                            <%= link_to "Accommodation", new_itinerary_destination_accommodation_path(@itinerary, d) %>
                            <%= link_to "Activity", new_itinerary_destination_activity_path(@itinerary, d)%>
                        </div>
                    <%end%>
                </div>
            <% end %>
        </div>
    </div>
        <% if @itinerary.user == current_user %>
            <%= link_to "Add destination", new_itinerary_destination_path(@itinerary) %>
        <% end %>    
</div>